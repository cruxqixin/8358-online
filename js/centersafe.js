itz.safe={init:function(safeData){$.validator.setDefaults({errorClass:"form-style-1-error"}),$.validator.methods.phone=function(value){var patten=new RegExp(/^1\d{10}$/);return patten.test(value)},$.validator.methods.idCard=function(value){var patten=new RegExp(/^\d{17}[0-9xX]$/);return patten.test(value)},$.validator.methods.chinese=function(value){var patten=new RegExp(/^[\u4e00-\u9fa5]+$/);return patten.test(value)},$.validator.methods.idCard2=function(value){if(1==$("#card_type").val()){var patten=new RegExp(/^\d{17}[0-9xX]$/);return patten.test(value)}return!0},$.validator.methods.isDifferent=function(value,element,param){return $(param).val()===value?!1:!0},this.bindBtns(safeData),this.questionnaire(safeData,function(){}),$("body").delegate(".ps1-close","click",function(){var id=$(this).parents(".ui-dialog-content").attr("id");$("#"+id).dialog("close")})},bindBtns:function(safeData){var objThis=this,openedObj={},util=itz.util;$("#saftyPageList").delegate(".user-safety-options-state","click",function(){var $that=$(this);if(!$that.hasClass(".user-safety-options-state-false"))switch($that.attr("id")){case"realnameBtn2":util.promptA("Drawings_prompt","promptTmpl",["实名认证提示","实名认证信息禁止修改~","您可以拨打：400-600-4300，联系客服进行修改~",2]);break;case"realnameBtn1":openedObj.realName||(objThis.realName(safeData),openedObj.realName=1),objThis.basicBtnEvent($that);break;case"phoneBtn1":openedObj.phone||(objThis.phone(safeData.phoneUrl),openedObj.phone=1),objThis.basicBtnEvent($that,function($t,$con){$con.find("#phoneCon1").show()},function($t,$con){$con.find("#phoneCon1").hide(),$con.find("form")[0].reset()});break;case"phoneBtn2":util.promptA("Drawings_prompt","promptTmpl",["手机认证提示","手机认证信息暂时禁止修改~","您可以拨打：400-600-4300，联系客服进行修改~",2]);break;case"emailBtn1":openedObj.email||(objThis.email.step1(safeData.emailUrl),objThis.email.step2(safeData.emailUpdateUrl),openedObj.email=1),objThis.basicBtnEvent($that,function($t,$con){$con.find("#emailCon1").show()},function($t,$con){$con.find("#emailCon1").hide(),$con.find("#emailCon11").show(),$con.find("#emailCon12").hide(),$con.find("form").each(function(){this.reset()})});break;case"emailBtn2":openedObj.email||(objThis.email.step1(safeData.emailUrl),objThis.email.step2(safeData.emailUpdateUrl),openedObj.email=1),objThis.basicBtnEvent($that,function($t,$con){$con.find("#emailCon21").show(),$con.find("#emailCon2").show()},function($t,$con){$con.find("#emailCon2").hide(),$con.find("#emailCon22").hide(),$con.find("form").each(function(){this.reset()})});break;case"pwdBtn1":openedObj.pwd||(objThis.pwd(safeData.pwdUrl),openedObj.pwd=1),objThis.basicBtnEvent($that,void 0,function($t,$con){$con.find("form").each(function(){this.reset()})});break;case"payPwdBtn1":openedObj.payPwd||(objThis.payPwd.step1(safeData.payPwdUrl),objThis.payPwd.step2(safeData.payPwdUrl),objThis.payPwd.step3(safeData),openedObj.payPwd=1),objThis.basicBtnEvent($that,function($t,$con){$con.find("#payPwdCon1").show()},function($t,$con){$con.find("#payPwdCon1").hide(),$con.find("#payPwdCon2").hide(),$con.find("#payPwdCon3").hide(),$con.find("form").each(function(){this.reset()})});break;case"payPwdBtn2":openedObj.payPwd||(objThis.payPwd.step2(safeData.payPwdUrl),objThis.payPwd.step3(safeData),openedObj.payPwd=1),objThis.basicBtnEvent($that,function($t,$con){$con.find("#payPwdCon2").show()},function($t,$con){$con.find("#payPwdCon2").hide(),$con.find("#payPwdCon3").hide(),$con.find("form").each(function(){this.reset()})});break;case"questionBtn1":openedObj.question||(objThis.question.step1(safeData.questionUrl),objThis.question.step2(),objThis.question.step3(safeData.questionUrl),openedObj.question=1),objThis.basicBtnEvent($that,function($t,$con){$con.find("#questionCon1").show()},function($t,$con){$con.find("#questionCon1").hide()});break;case"questionBtn2":openedObj.question||(objThis.question.step1(safeData.questionUrl),objThis.question.step2(),objThis.question.step3(safeData.questionUrl),openedObj.question=1),objThis.basicBtnEvent($that,function($t,$con){$con.find("#questionCon2").show()},function($t,$con){$con.find("form").each(function(){this.reset()}),$con.find("#questionCon1").hide(),$con.find("#questionCon2").hide(),$con.find("#questionCon3").hide()})}}),$("#realApiCon").parents(".user-safety-options-edit").find(".switchUploadMode").click(function(){$("#realApiCon").is(":hidden")?($("#realUploadCon").hide(),$("#realApiCon").show()):($("#realApiCon").hide(),$("#realUploadCon").show())})},realName:function(safeData){var that=this,$realApiCon=$("#realApiCon"),$realUploadCon=$("#realUploadCon"),$uploadBtn1=($("#switchUpload"),$("#uploadBtn1")),$cardUpload1=$("#cardUpload1"),$uploadBtn2=$("#uploadBtn2"),$cardUpload2=$("#cardUpload2"),uploadStatus1=0,uploadStatus2=0;$("#card_type").change(function(){var $error=$realUploadCon.find("#idcardError");"1"!=$(this).val&&$error.empty()}),$realApiCon.find("form").validate({errorPlacement:function(error,element){element.parent().next().html(error)},submitHandler:function(form){var promptA=itz.util.promptA,$submitBtn=$("#realSubmitBtn1"),cardValue=$realApiCon.find("input[name=card_id]").val(),idCardInfo=that.getInfoByIdCard(cardValue);return 0!==idCardInfo.code?(promptA("Drawings_prompt","promptTmpl",["实名认证提示","您的身份证号不合法~","请仔细检查并认真输入~<br/>",0]),void 0):($submitBtn.attr("disabled",!0).val("提交中..."),$.ajax({url:safeData.realnameApi,type:"post",dataType:"json",data:$(form).serialize()+"&realname_type=1&sex="+idCardInfo.data.sex+"&birthday="+idCardInfo.data.birthday,success:function(data){if(0===data.code){var $item=$realApiCon.parents(".user-safety-options-item");$item.find(".user-safety-options-edit").slideUp(),$item.find(".icon-tanhao").removeClass("icon-tanhao").addClass("icon-check"),$item.find(".user-safety-options-value").text(data.data.maskcard),$item.find("#realnameBtn1").attr("id","realnameBtn2").attr("switchText","取消修改").text("修改"),promptA("Drawings_prompt","promptTmpl",["实名认证提示","实名认证成功~","",1])}else promptA("Drawings_prompt","promptTmpl",["实名认证提示","实名认证失败~","原因："+data.info+"<br/>",0]);$submitBtn.removeAttr("disabled").val("提交实名认证")},error:function(){promptA("Drawings_prompt","promptTmpl",["实名认证提示","由于网络原因，验证失败！","您可以点击按钮重试，或联系网站客服~~<br/>",0]),$submitBtn.removeAttr("disabled").val("提交实名认证")}}),void 0)},rules:{realname:{required:!0,rangelength:[2,6],chinese:!0},card_id:{required:!0,idCard:!0},serviceAgreement:{required:!0}},messages:{realname:{required:"请输入您的真实姓名~",rangelength:"名字请在2-6位之间呦~",chinese:"请输中文名字~"},card_id:{required:"请输入身份证号码~",idCard:"身份证号码需要是18位的标准格式~"},serviceAgreement:{required:"请同意爱投资服务协议~"}}}),$realUploadCon.find("form").validate({errorPlacement:function(error,element){element.parent().next().html(error)},submitHandler:function(form){var idCardInfo,promptA=itz.util.promptA,$submitBtn=$("#realSubmitBtn2"),cardValue=$realUploadCon.find("input[name=card_id]").val();return"1"==$realUploadCon.find("#card_type").val()&&(idCardInfo=that.getInfoByIdCard(cardValue),0!==idCardInfo.code)?(promptA("Drawings_prompt","promptTmpl",["实名认证提示","您的身份证号不合法~","请仔细检查并认真输入~<br/>",0]),void 0):$("#card_pic1").val()?$("#card_pic2").val()?uploadStatus1||uploadStatus2?(promptA("Drawings_prompt","promptTmpl",["实名认证提示","正在上传图片中……","请稍后再提交~<br/>",0]),void 0):($submitBtn.attr("disabled",!0).val("提交中..."),$.ajax({url:safeData.realnameApi,type:"post",dataType:"json",data:$(form).serialize()+"&realname_type=2&sex="+idCardInfo.data.sex+"&birthday="+idCardInfo.data.birthday,success:function(data){if(0===data.code){var $item=$realApiCon.parents(".user-safety-options-item");$item.find("#realnameBtn1").attr("id","realnameBtn2").attr("switchText","取消审核").text("审核中").addClass("user-safety-options-state-false"),$item.find(".user-safety-options-edit").slideUp(),promptA("Drawings_prompt","promptTmpl",["实名认证提示","上传资料成功~","请等待管理员的审核<br/>",1])}else promptA("Drawings_prompt","promptTmpl",["实名认证提示","上传资料失败~","原因："+data.info+"<br/>",0]);$submitBtn.removeAttr("disabled").val("提交实名认证")},error:function(){promptA("Drawings_prompt","promptTmpl",["实名认证提示","由于网络原因，验证失败！","您可以点击按钮重试，或联系网站客服~~<br/>",0]),$submitBtn.removeAttr("disabled").val("提交实名认证")}}),void 0):($("#cardError2").text("请上传身份证背面~"),void 0):($("#cardError1").text("请上传身份证正面~"),void 0)},rules:{realname:{required:!0,rangelength:[2,6],chinese:!0},card_id:{required:!0,idCard2:!0},serviceAgreement:{required:!0}},messages:{realname:{required:"请输入您的真实姓名~",rangelength:"名字请在2-6位之间呦~",chinese:"请输中文名字~"},card_id:{required:"请输入证件号码~",idCard2:"身份证号码需要是18位的标准格式~"},serviceAgreement:{required:"请同意爱投资服务协议~"}}}),$cardUpload1.fileupload({url:safeData.uploadUrl+"?type=card",dataType:"json",add:function(e,data){var thisFile=data.originalFiles[0],$cardError1=$("#cardError1");return/(\.|\/)(gif|jpe?g|png)$/i.test(thisFile.name)?thisFile.size>2097152?($cardError1.text("上传失败，文件超过2m了喔~"),void 0):($cardError1.html('<img src="'+safeData.loading+'">'),$cardUpload1.attr("disabled",!0),uploadStatus1=1,$uploadBtn1.find("em").text("上传中..."),data.submit().success(function(result){0==result.code?($("#cardUploadImg1 img").attr("src",result.data.file_domain+result.data.file_src),$cardError1.text(""),$("#card_pic1").val(result.data.file_src)):$cardError1.text("上传失败，请重新尝试~")}).error(function(){$cardError1.text("上传失败，请重新尝试~")}).complete(function(){$cardUpload1.removeAttr("disabled"),$uploadBtn1.find("em").text("上传图片"),uploadStatus1=0}),void 0):($cardError1.text("上传失败，只能上传后缀为gif|jpeg|png的图片喔~"),void 0)},done:function(){}}),$cardUpload2.fileupload({url:safeData.uploadUrl+"?type=card",dataType:"json",add:function(e,data){var thisFile=data.originalFiles[0],$cardError2=$("#cardError2");return/(\.|\/)(gif|jpe?g|png)$/i.test(thisFile.name)?thisFile.size>2097152?($cardError2.text("上传失败，文件超过2m了喔~"),void 0):($cardError2.html('<img src="'+safeData.loading+'">'),$cardUpload2.attr("disabled",!0),uploadStatus2=1,$uploadBtn2.find("em").text("上传中..."),data.submit().success(function(result){0==result.code?($("#cardUploadImg2 img").attr("src",result.data.file_domain+result.data.file_src),$cardError2.text(""),$("#card_pic2").val(result.data.file_src)):$cardError2.text("上传失败，请重新尝试~")}).error(function(){$cardError2.text("上传失败，请重新尝试~")}).complete(function(){$cardUpload2.removeAttr("disabled"),$uploadBtn2.find("em").text("上传图片"),uploadStatus2=0}),void 0):($cardError2.text("上传失败，只能上传后缀为gif|jpeg|png的图片喔~"),void 0)},done:function(){}})},phone:function(url){var $phoneCon1=$("#phoneCon1");$("#sendSmsBtn").itzCutDownBtn($("#phoneNum"),url),$phoneCon1.find("form").validate({errorPlacement:function(error,element){element.parents(".form-style-1-item").find(".form-style-1-error").html(error)},submitHandler:function(form){var $submitBtn=$("#phoneSubmitBtn");$submitBtn.attr("disabled",!0).val("请稍后..."),$.ajax({url:url,type:"post",dataType:"json",data:$(form).serialize(),success:function(data){var $step=$phoneCon1.attr("_step"),$status=$("#phoneStatus1");if(0===data.code){var $item=$phoneCon1.parents(".user-safety-options-item");$phoneCon1.hide(),"1"==$step?($item.find(".icon-tanhao").removeClass("icon-tanhao").addClass("icon-check"),$item.find(".user-safety-options-value").text(data.data.maskphone),$item.find("#phoneBtn1").attr("id","phoneBtn2").attr("switchText","取消修改").text("修改"),$item.find("form")[0].reset(),itz.util.promptA("Drawings_prompt","promptTmpl",["手机认证提示","恭喜您成功认证手机号","",1]),$item.find(".user-safety-options-edit").slideUp(),$phoneCon1.attr("_step","2")):"2"==$step?($status.hide(),itz.safe.statusShow($("#phoneCon2"),"恭喜您成功验证原手机号",function(){itz.safe.GoStep($status,2),$status.fadeIn(),$phoneCon1.fadeIn()}),$item.find("form")[0].reset(),$item.find("#phoneNewText").text("新手机号码"),$phoneCon1.attr("_step","3")):($status.hide(),itz.safe.statusShow($("#phoneCon2"),"恭喜您成功认证新手机",function(){itz.safe.GoStep($status,1),$status.fadeIn(),$phoneCon1.fadeIn()}),$item.find("form")[0].reset(),$item.find("#phoneNewText").text("原手机号码"),$phoneCon1.attr("_step","2"))}else $phoneCon1.hide(),"1"!=$step?($status.hide(),itz.safe.statusShow($("#phoneCon2"),"验证失败，原因是："+data.info,function(){itz.safe.GoStep($status,1),$phoneCon1.fadeIn()})):itz.safe.statusShow($("#phoneCon2"),"验证失败，原因是："+data.info,function(){$phoneCon1.fadeIn()});$submitBtn.removeAttr("disabled").val("下一步")},error:function(){itz.util.promptA("Drawings_prompt","promptTmpl",["手机认证提示","爱亲，由于网络原因，提交失败！","您可以点击添加重试，或联系网站客服~~<br/>",0]),$submitBtn.removeAttr("disabled").val("下一步")}})},rules:{phone:{required:!0,phone:!0},sms_vcode:{required:!0,digits:!0,rangelength:[6,6]}},messages:{phone:{required:"请输入手机号~",phone:"请输出正确的手机号喔，亲~"},sms_vcode:{required:"请输入手机验证码~",digits:"验证码必须为数字喔~",rangelength:"验证码为6位数字~"}}})},email:{step1:function(url){var $emailCon1=$("#emailCon1"),that=this;$emailCon1.find("form").validate({submitHandler:function(form){var $submitBtn=$("#emailSendSubmit1");$submitBtn.attr("disabled",!0).val("发送中..."),$.ajax({url:url,type:"post",dataType:"json",data:$(form).serialize(),success:function(data){0===data.code?($emailCon1.find("#emailCon11").hide(),$("#gotoEmailBtn1").attr("href",that.getEmailUrl($(form).find("input[name=email]").val())),$emailCon1.find("#emailCon12").fadeIn()):itz.util.promptA("Drawings_prompt","promptTmpl",["邮箱验证提示","邮箱验证失败","原因是："+data.info+"<br/>",0]),$submitBtn.removeAttr("disabled").val("发送验证邮件")},error:function(){itz.util.promptA("Drawings_prompt","promptTmpl",["邮箱验证提示","爱亲，由于网络原因，提交失败！","您可以点击添加重试，或联系网站客服~~<br/>",0]),$submitBtn.removeAttr("disabled").val("发送验证邮件")}})},rules:{email:{required:!0,email:!0,rangelength:[5,50]}},messages:{email:{required:"请输入邮箱~",email:"邮箱格式不正确喔，亲~",rangelength:"邮箱长度请控制在5-50位~"}}})},step2:function(url){var $emailCon2=$("#emailCon2"),that=this;$emailCon2.find("form").validate({submitHandler:function(form){var $submitBtn=$("#emailSendSubmit2");$submitBtn.attr("disabled",!0).val("发送中..."),$.ajax({url:url,type:"post",dataType:"json",data:$(form).serialize(),success:function(data){0===data.code?($emailCon2.parents(".user-safety-options-item"),$emailCon2.find("#emailCon21").hide(),$("#gotoEmailBtn2").attr("href",that.getEmailUrl($(form).find("input[name=email]").val())),$emailCon2.find("#emailCon22").fadeIn()):itz.util.promptA("Drawings_prompt","promptTmpl",["邮箱验证提示","爱亲，邮箱验证失败了！","原因是："+data.info+"<br/>",0]),$submitBtn.removeAttr("disabled").val("发送验证邮件")},error:function(){itz.util.promptA("Drawings_prompt","promptTmpl",["邮箱验证提示","爱亲，由于网络原因，提交失败！","您可以点击添加重试，或联系网站客服~~<br/>",0]),$submitBtn.removeAttr("disabled").val("发送验证邮件")}})},rules:{email:{required:!0,email:!0,rangelength:[5,50],isDifferent:"#emailCon2 input[name=oldemail]"},oldemail:{required:!0,email:!0,rangelength:[5,50]}},messages:{email:{required:"请输入邮箱~",email:"邮箱格式不正确喔，亲~",rangelength:"邮箱长度请控制在5-50位~",isDifferent:"新邮箱和原邮箱不能一样喔~"},oldemail:{required:"请输入原邮箱~",email:"邮箱格式不正确喔，亲~",rangelength:"邮箱长度请控制在5-50位~"}}})},getEmailUrl:function(email){if(email){var temp=email.split("@");return"gmail.com"===temp[1]?"http://www.gmail.com":"http://mail."+temp[1]}}},pwd:function(url){var $pwdCon1=$("#pwdCon1");$pwdCon1.find("form").validate({submitHandler:function(form){var $submitBtn=$("#pwdSubmit");$submitBtn.attr("disabled",!0).val("修改中..."),$.ajax({url:url,type:"post",dataType:"json",data:$(form).serialize(),success:function(data){if(0===data.code){var $item=$pwdCon1.parents(".user-safety-options-item");$pwdCon1.hide(),itz.safe.statusShow($("#pwdCon2"),"恭喜您成功修改密码",function(){$("#pwdCon1").fadeIn()}),$item.find("form").each(function(){this.reset()})}else itz.util.promptA("Drawings_prompt","promptTmpl",["登录密码提示","爱亲，修改失败！","原因："+data.info+"<br/>",0]);$submitBtn.removeAttr("disabled").val("修改登录密码")},error:function(){itz.util.promptA("Drawings_prompt","promptTmpl",["登录密码提示","爱亲，由于网络原因，提交失败！","您可以点击添加重试，或联系网站客服~~<br/>",0]),$submitBtn.removeAttr("disabled").val("修改登录密码")}})},rules:{oldpassword:{required:!0,rangelength:[6,16]},newpassword:{required:!0,rangelength:[6,16],isDifferent:"#pwdCon1 input[name=oldpassword]"},newpassword1:{equalTo:"#pwdpas"}},messages:{oldpassword:{required:"请输入原登录密码~",rangelength:"密码请控制在6-16位以内喔~"},newpassword:{required:"请输入新登录密码~",rangelength:"密码请控制在6-16位以内喔~",isDifferent:"新密码不能和原密码一样喔~"},newpassword1:{equalTo:"请和上一次输入的密码保持一致~"}}})},payPwd:{step1:function(url){var $ppCon1=$("#payPwdCon1");$ppCon1.find("form").validate({submitHandler:function(form){var $submitBtn=$("#ppSubmit1");$submitBtn.attr("disabled",!0).val("设置中..."),$.ajax({url:url,type:"post",dataType:"json",data:$(form).serialize(),success:function(data){if(0===data.code){var $item=$ppCon1.parents(".user-safety-options-item");$ppCon1.hide(),itz.safe.statusShow($("#payPwdCon4"),"恭喜您成功设置支付密码",function(){$("#payPwdCon2").fadeIn()}),$item.find("form").each(function(){this.reset()}),$item.find(".icon-tanhao").removeClass("icon-tanhao").addClass("icon-check"),$item.find(".user-safety-options-value-false").removeClass("user-safety-options-value-false").text("已设置"),$item.find("#payPwdBtn1").attr("id","payPwdBtn2").attr("switchText","修改").text("取消修改")}else itz.util.promptA("Drawings_prompt","promptTmpl",["设置支付密码提示","爱亲，设置失败！","原因："+data.info+"<br/>",0]);$submitBtn.removeAttr("disabled").val("设置支付密码")},error:function(){itz.util.promptA("Drawings_prompt","promptTmpl",["设置支付密码提示","爱亲，由于网络原因，提交失败！","您可以点击添加重试，或联系网站客服~~<br/>",0]),$submitBtn.removeAttr("disabled").val("设置支付密码")}})},rules:{oldpassword:{required:!0,rangelength:[6,16]},newpassword:{required:!0,rangelength:[6,16],isDifferent:"#payPwdCon1 input[name=oldpassword]"},newpassword1:{equalTo:"#pas1"}},messages:{oldpassword:{required:"请输入登录密码~",rangelength:"密码请控制在6-16位以内喔~"},newpassword:{required:"请输入支付密码~",rangelength:"密码请控制在6-16位以内喔~",isDifferent:"新密码不能和登录密码一样喔~"},newpassword1:{equalTo:"请和上一次输入的密码保持一致~"}}})},step2:function(url){var $ppCon2=$("#payPwdCon2");$ppCon2.find("#findPayPwdBtn").click(function(){$ppCon2.hide(),$("#payPwdCon3").fadeIn()}),$ppCon2.find("form").validate({submitHandler:function(form){var $submitBtn=$("#ppSubmit2");$submitBtn.attr("disabled",!0).val("修改中..."),$.ajax({url:url,type:"post",dataType:"json",data:$(form).serialize(),success:function(data){if(0===data.code){var $item=$ppCon2.parents(".user-safety-options-item");$ppCon2.hide(),itz.safe.statusShow($("#payPwdCon4"),"恭喜您成功修改支付密码",function(){$("#payPwdCon2").fadeIn()}),$item.find("form").each(function(){this.reset()})}else itz.util.promptA("Drawings_prompt","promptTmpl",["修改支付密码提示","爱亲，设置失败！","原因："+data.info+"<br/>",0]);$submitBtn.removeAttr("disabled").val("修改支付密码")},error:function(){itz.util.promptA("Drawings_prompt","promptTmpl",["修改支付密码提示","爱亲，由于网络原因，提交失败！","您可以点击添加重试，或联系网站客服~~<br/>",0]),$submitBtn.removeAttr("disabled").val("修改支付密码")}})},rules:{oldpassword:{required:!0,rangelength:[6,16]},newpassword:{required:!0,rangelength:[6,16],isDifferent:"#payPwdCon2 input[name=oldpassword]"},newpassword1:{equalTo:"#pas2"}},messages:{oldpassword:{required:"请输入原支付密码~",rangelength:"密码请控制在6-16位以内喔~"},newpassword:{required:"请输入新支付密码~",rangelength:"密码请控制在6-16位以内喔~",isDifferent:"新密码不能和原密码一样喔~"},newpassword1:{equalTo:"请和上一次输入的密码保持一致~"}}})},step3:function(safeData){var $ppCon3=$("#payPwdCon3");$ppCon3.find("#sendSmsBtn3").itzCutDownBtn(void 0,safeData.findPayPwdPhoneUrl),$ppCon3.find("form").validate({errorPlacement:function(error,element){element.parents(".form-style-1-item").find(".form-style-1-error").html(error)},submitHandler:function(form){var $submitBtn=$("#ppSubmit3");$submitBtn.attr("disabled",!0).val("修改中..."),$.ajax({url:safeData.findPayPwdUrl,type:"post",dataType:"json",data:$(form).serialize(),success:function(data){if(0===data.code){var $item=$ppCon3.parents(".user-safety-options-item");$ppCon3.hide(),itz.safe.statusShow($("#payPwdCon4"),"恭喜您成功修改支付密码",function(){$("#payPwdCon2").fadeIn()}),$item.find("form").each(function(){this.reset()})}else itz.util.promptA("Drawings_prompt","promptTmpl",["修改支付密码提示","爱亲，设置失败！","原因："+data.info+"<br/>",0]);$submitBtn.removeAttr("disabled").val("修改支付密码")},error:function(){itz.util.promptA("Drawings_prompt","promptTmpl",["修改支付密码提示","爱亲，由于网络原因，提交失败！","您可以点击添加重试，或联系网站客服~~<br/>",0]),$submitBtn.removeAttr("disabled").val("修改支付密码")}})},rules:{sms_vcode:{required:!0,digits:!0,rangelength:[6,6]},newpassword:{required:!0,rangelength:[6,16],isDifferent:"#payPwdCon3 input[name=oldpassword]"},newpassword1:{equalTo:"#pas3"}},messages:{sms_vcode:{required:"请输入手机验证码~",digits:"验证码必须为数字喔~",rangelength:"验证码为6位数字~"},newpassword:{required:"请输入新支付密码~",rangelength:"密码请控制在6-16位以内喔~",isDifferent:"新密码不能和原密码一样喔~"},newpassword1:{equalTo:"请和上一次输入的密码保持一致~"}}})}},question:{step1:function(url){var $qCon1=$("#questionCon1");$qCon1.find(".nnnn").click(function(){}),$qCon1.find("form").validate({submitHandler:function(form){var $submitBtn=$("#qSetSubmit");$submitBtn.attr("disabled",!0).val("设置中..."),$.ajax({url:url,type:"post",dataType:"json",data:$(form).serialize()+"&type=2",success:function(data){if(0===data.code){var $item=$qCon1.parents(".user-safety-options-item");$qCon1.hide(),itz.safe.statusShow($("#questionCon4"),"恭喜您成功设置密码保护",function(){$("#questionCon2").fadeIn()}),$item.find(".icon-tanhao").removeClass("icon-tanhao").addClass("icon-check"),$item.find(".user-safety-options-value-false").removeClass("user-safety-options-value-false").text("已设置"),$item.find("#questionBtn1").attr("id","questionBtn2").attr("switchText","修改").text("取消修改");var selectedText=$("#question option:selected").text();$("#currentQues1").text(selectedText),$("#currentQues2").text(selectedText),$item.find("form").each(function(){this.reset()})}else itz.util.promptA("Drawings_prompt","promptTmpl",["密码保护提示","设置失败！","原因："+data.info+"<br/>",0]);$submitBtn.removeAttr("disabled").val("设置")},error:function(){itz.util.promptA("Drawings_prompt","promptTmpl",["密码保护提示","爱亲，由于网络原因，提交失败！","您可以点击添加重试，或联系网站客服~~<br/>",0]),$submitBtn.removeAttr("disabled").val("设置")}})},rules:{answer:{required:!0,rangelength:[1,20]}},messages:{answer:{required:"需要输入答案喔~",rangelength:"字数请控制在1-20个以内喔~"}}})},step2:function(){var $qCon2=$("#questionCon2");$qCon2.find("#resetBtn").click(function(){$qCon2.hide(),$("#questionCon3").fadeIn()})},step3:function(url){var $qCon3=$("#questionCon3");$qCon3.find("form").validate({submitHandler:function(form){var $submitBtn=$("#qCheckSubmit");$submitBtn.attr("disabled",!0).val("验证中..."),$.ajax({url:url,type:"post",dataType:"json",data:$(form).serialize()+"&type=1",success:function(data){0===data.code?($qCon3.hide(),$("#questionCon1").fadeIn()):itz.util.promptA("Drawings_prompt","promptTmpl",["密码保护提示","验证失败！","原因："+data.info+"<br/>",0]),$submitBtn.removeAttr("disabled").val("验证当前答案")},error:function(){itz.util.promptA("Drawings_prompt","promptTmpl",["密码保护提示","爱亲，由于网络原因，提交失败！","您可以点击添加重试，或联系网站客服~~<br/>",0]),$submitBtn.removeAttr("disabled").val("验证当前答案")}})},rules:{answer:{required:!0,rangelength:[1,20]}},messages:{answer:{required:"需要输入答案喔~",rangelength:"字数请控制在1-20个以内喔~"}}})}},basicBtnEvent:function($t,fn1,fn2){var btnText=$t.html(),$con=$t.parents(".user-safety-options-item").find(".user-safety-options-edit");$t.hasClass("safe-off")?($con.slideUp(function(){fn2&&fn2($t,$con)}),$t.removeClass("safe-off")):(fn1&&fn1($t,$con),$con.slideDown(),$t.addClass("safe-off")),$t.html($t.attr("switchtext")).attr("switchtext",btnText)},GoStep:function($spanArray,num){num=num||1,$spanArray.each(function(index,ele){return $ele=$(ele),index>num-1&&$ele.hasClass("options-step-current")?($ele.removeClass("options-step-current"),!0):(num-1>=index&&!$ele.hasClass("options-step-current")&&$ele.addClass("options-step-current"),void 0)})},statusShow:function($statusCon,text,fn){$statusCon.find(".user-safety-options-succeed-txt").text(text),$statusCon.fadeIn(function(){var $t=$(this);setTimeout(function(){$t.fadeOut(function(){fn&&fn()})},1500)})},getInfoByIdCard:function(sId){var iSum=0;if(!/^\d{17}(\d|x)$/i.test(sId))return{code:1,info:"请填写有效并且是18位的身份证喔~"};sId=sId.replace(/x$/i,"a"),sBirthday=sId.substr(6,4)+"-"+Number(sId.substr(10,2))+"-"+Number(sId.substr(12,2));var d=new Date(sBirthday.replace(/-/g,"/"));if(sBirthday!=d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate())return{code:1,info:"请填写有效的身份证号码喔~"};for(var i=17;i>=0;i--)iSum+=Math.pow(2,i)%11*parseInt(sId.charAt(17-i),11);return 1!=iSum%11?{code:1,info:"请填写有效的身份证号码喔~"}:{code:0,data:{birthday:sBirthday,sex:sId.substr(16,1)%2?1:2}}},questionnaire:function(safeData,fn){var ajaxVar,index_questionnaire=$("#index_questionnaire"),index_questionnaire_win=$("#index_questionnaire_win");$("#index_questionnaire_real_name").text(safeData.userName),$("#Index_questionnaire_btn").click(function(){index_questionnaire.dialog({dialogClass:"clearPop pop-style-1",resizable:!1,modal:!0,width:650,close:function(){index_questionnaire.find(":radio").removeAttr("checked"),$(this).find("dt b").remove(),$("#diaochashengming").hide(),ajaxVar&&ajaxVar.abort(),$("#index_questionnaire .ps2-txt-con #loginloding").remove()}})}),index_questionnaire.find(":radio").click(function(){$(this).parents("dl").find("dt b").remove()}),index_questionnaire.find("form").submit(function(){var eleRedio=($(this),null),state=!0,arr={};ajaxVar&&ajaxVar.abort();for(var i=1;11>i;i++)eleRedio=$(this["questionnaire"+i]),eleRedioDt=eleRedio.parents("dl").find("dt"),eleRedio.is(":checked")?(eleRedioDt.find("b").length>0&&eleRedioDt.find("b").remove(),arr["questionnaire"+i]=function(){for(var x=0;x<eleRedio.length;x++)if($(eleRedio[x]).is(":checked"))return eleRedio[x].value}()):(eleRedioDt.find("b").length||eleRedioDt.append("<b>此项未选择</b>"),state=!1);if(!state)return!1;var ajaxData=arr;return ajaxVar=$.ajax({url:"/newuser/ajax/addQn",type:"POST",dataType:"json",data:ajaxData,timeout:1e4,beforeSend:function(){$("#index_questionnaire .ps2-txt-con").append('<img src="'+safeData.loading+'" style="margin-top:82px;position:absolute;top:698px; right:200px" id="loginloding"/>')},error:function(jqXHR,textStatus){"timeout"==textStatus&&$("#index_questionnaire .ps2-txt-con #loginloding").remove()},success:function(data){$("#index_questionnaire .ps2-txt-con #loginloding").remove(),0==data.code?(index_questionnaire.find(".ps1-error").hide(),data.data.score<50&&$("#diaochashengming").show(),setTimeout(function(){index_questionnaire.dialog("close"),index_questionnaire_win.dialog({dialogClass:"clearPop box-shadow-5",resizable:!1,modal:!0,width:500,open:function(){$("#wenjuandefen").text(data.data.score),window.User.qn_score=data.data.score,$("#index_questionnaire_html").find(".user-safety-options-value").removeClass("user-safety-options-value-false").text("已设置"),$("#index_questionnaire_html i").addClass("icon-check").removeClass("icon-tanhao"),$("#Index_questionnaire_btn").remove()}})},1e3)):index_questionnaire.find(".ps1-error").text(data.info).show()}}),!1}),index_questionnaire_win.find("input").click(function(){return index_questionnaire_win.dialog("close"),fn(window.User.qn_score),!1})}};